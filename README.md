# altera-soc-mpl

## Инструкция

1. Создать проект в Quartus.
1. Запустить Qsys.
1. Добавить компонент hps. Перейти в режим редактирования этого компонента.
1. Настроить клоки. Добавить UART0 для поддержки печати в консоль, добавить QSPI (пины, на которые мапить, посмотреть по схеме кита).
1. Отредактировать параметры SDRAM, начать можно с шаблона JEDEC.
1. Сохранить. Сгенерировать HDL.
1. В top-level исходном файле проекта добавить порты для всех компонентов hps - памяти, UART, QSPI, имена портов можно взять в сгенерированных файлах.
1. Запустить Analysis & Syntesis.
1. Открыть в Quartus Tcl console, запустить ` hps_sdram_p0_pin_assignments.tcl`, это производит настройку пинов компонента.
1. Запустить полную сборку. Сборка на этапе ассемблера создать директорию `hps_isw_handoff`, которая содержит информацию о настроках внутренностей hps компонента и код для теста SDRAM. Зачем для генерации пререквезитов для процессорной части производить синтез проекта FPGA - индусская загадка.
1. Запустить bs-editor ($EDS_SOC/embedded/host_tools/altera/preloadergen), в нём:
    1. File->New BSP
    1. Указать путь до внутреней директории в `hps_isw_handoff`.
    1. Установить требуемые параметры - например, загрузку из QSPI.
    1. Нажать кнопку `Generate`.
    1. Это создаст директорию `software/spl_bsp` и её содержимое.
1. Скопировать в корень проекта заготовку MPL: из файла $EDS_SOC/embedded/examples/software/Altera-SoCFPGA-HardwareLib-MPL.tar.gz
1. Отредактировать внутри этой заготовки файлы для сборки: config.mk и Makefile: указать источник загрузки, тип дивайса, путь к тулчейну и к директориям со сгенерированными файлами - тем, которые сгенерировал Quartus и bsp-editor.
1. Запустить сборку: make.
1. В DS-5 создать bare-metal проект и указать .axf файл (на самом деле это .elf)
